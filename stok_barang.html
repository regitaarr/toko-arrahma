<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stok Barang - Toko Arrahma</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Stok Barang</h1>
            <nav style="margin-bottom:16px;">
                <a href="tambah_barang.html" class="btn">Tambah Barang</a>
                <a href="kasir.html" class="btn">Transaksi</a>
            </nav>
        </div>
        <div style="margin-bottom:16px; display:flex; gap:12px; flex-wrap:wrap; align-items:center;">
            <div>
                <label for="kategoriDropdown" style="font-weight:bold;">Filter Kategori:</label>
                <select id="kategoriDropdown" style="padding:8px 12px;border-radius:8px;border:1px solid #ccc;">
                    <option value="">Semua Kategori</option>
                </select>
            </div>
            <div>
                <label for="searchInput" style="font-weight:bold;">Cari Nama:</label>
                <input id="searchInput" type="text" placeholder="Ketik nama barang..." style="padding:8px 12px;border-radius:8px;border:1px solid #ccc; min-width:220px;">
            </div>
        </div>
        <div class="panel">
            <h2>Daftar Stok Barang</h2>
            <table class="table" id="stokTable">
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nama</th>
                        <th>Kategori</th>
                        <th>Harga</th>
                        <th>Stok</th>
                        <th>Aksi</th>
                    </tr>
                </thead>
                <tbody id="stokTableBody">
                    <!-- Data diisi dari Firestore -->
                </tbody>
            </table>
        </div>
    </div>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>
    <script>
    const firebaseConfig = {
      apiKey: "AIzaSyADPQ_EU2m4s4HNDYFkid03osfUfiEUmUs",
      authDomain: "web-toko-40273.firebaseapp.com",
      projectId: "web-toko-40273",
      storageBucket: "web-toko-40273.firebasestorage.app",
      messagingSenderId: "207266690704",
      appId: "1:207266690704:web:bcc5d16b6c9e3780088a15",
      measurementId: "G-EGDRL1NKXZ"
    };
    if (!firebase.apps.length) {
      firebase.initializeApp(firebaseConfig);
    }
    const db = firebase.firestore();
    const kategoriDropdown = document.getElementById('kategoriDropdown');
    const stokTableBody = document.getElementById('stokTableBody');
    const searchInput = document.getElementById('searchInput');
    let allProducts = [];
    

    function renderKategoriDropdown(products) {
        const kategoriSet = new Set(products.map(p => p.type));
        kategoriDropdown.innerHTML = '<option value="">Semua Kategori</option>';
        kategoriSet.forEach(kat => {
            if (kat) kategoriDropdown.innerHTML += `<option value="${kat}">${kat}</option>`;
        });
    }

    function renderStokTable(products, kategori, keyword) {
        stokTableBody.innerHTML = '';
        const q = (keyword || '').toLowerCase();
        products
            .filter(p => (!kategori || p.type === kategori))
            .filter(p => (!q || (p.name || '').toLowerCase().includes(q)))
            .forEach((item) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td><input type="text" value="${item.id}" style="width:80px" disabled></td>
                    <td><input type="text" value="${item.name}" id="name_${item.__docId}" style="width:180px"></td>
                    <td><input type="text" value="${item.type}" id="type_${item.__docId}" style="width:120px"></td>
                    <td><input type="number" value="${item.price}" id="price_${item.__docId}" style="width:100px"></td>
                    <td><input type="number" value="${item.stock}" id="stock_${item.__docId}" style="width:80px"></td>
                    <td>
                        <button onclick="updateProduct('${item.__docId}')" class="btn btn-success" style="margin-bottom:4px;">Simpan</button>
                        <button onclick="deleteProduct('${item.__docId}')" class="btn btn-danger">Hapus</button>
                    </td>
                `;
                stokTableBody.appendChild(row);
            });
    }

    function listenProducts() {
        db.collection('products').onSnapshot(snapshot => {
            allProducts = snapshot.docs.map(doc => ({...doc.data(), __docId: doc.id}));
            renderKategoriDropdown(allProducts);
            renderStokTable(allProducts, kategoriDropdown.value, searchInput.value);
        });
    }

    kategoriDropdown.addEventListener('change', function() {
        renderStokTable(allProducts, kategoriDropdown.value, searchInput.value);
    });

    searchInput.addEventListener('input', function() {
        renderStokTable(allProducts, kategoriDropdown.value, searchInput.value);
    });

    window.updateProduct = function(docId) {
        const name = document.getElementById('name_'+docId).value;
        const type = document.getElementById('type_'+docId).value;
        const price = parseInt(document.getElementById('price_'+docId).value);
        const stock = parseInt(document.getElementById('stock_'+docId).value);
        db.collection('products').doc(docId).update({name, type, price, stock})
          .then(() => alert('Barang berhasil diupdate!'))
          .catch(err => alert('Gagal update: ' + err.message));
    }

    window.deleteProduct = function(docId) {
        if (!confirm('Yakin ingin menghapus barang ini?')) return;
        db.collection('products').doc(docId).delete()
          .then(() => alert('Barang berhasil dihapus!'))
          .catch(err => alert('Gagal hapus: ' + err.message));
    }

    listenProducts();
    </script>
</body>
</html> 
